<div class="container mx-auto p-6 max-w-4xl">
  <h1 class="text-3xl font-bold text-gray-800 mb-8">Créer une Nouvelle Destination</h1>

  <!-- Messages d'alerte -->
  <div *ngIf="erreur" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
    {{ erreur }}
  </div>

  <div *ngIf="succes" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
    {{ succes }}
  </div>

  <form [formGroup]="destinationForm" (ngSubmit)="onSubmit()" class="space-y-6">
    
    <!-- Section Informations de Base -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Nom -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Nom de la destination *</label>
        <input type="text" formControlName="nom" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Ex: Paris">
        <div *ngIf="nom?.invalid && nom?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="nom?.errors?.['required']">Le nom est obligatoire</div>
          <div *ngIf="nom?.errors?.['minlength']">Le nom doit avoir au moins 2 caractères</div>
        </div>
      </div>

      <!-- Code (3 lettres) -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Code IATA (3 lettres) *</label>
        <input type="text" formControlName="code" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 uppercase"
               placeholder="Ex: PAR" maxlength="3">
        <div *ngIf="code?.invalid && code?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="code?.errors?.['required']">Le code est obligatoire</div>
          <div *ngIf="code?.errors?.['pattern']">Le code doit contenir 3 lettres majuscules</div>
        </div>
      </div>
    </div>

    <!-- Section Localisation -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Pays -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Pays *</label>
        <select formControlName="pays"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">Sélectionnez un pays</option>
          <option *ngFor="let pays of paysListe" [value]="pays">{{ pays }}</option>
        </select>
        <div *ngIf="pays?.invalid && pays?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="pays?.errors?.['required']">Le pays est obligatoire</div>
        </div>
      </div>

      <!-- Ville -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Ville *</label>
        <input type="text" formControlName="ville" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Ex: Paris">
        <div *ngIf="ville?.invalid && ville?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="ville?.errors?.['required']">La ville est obligatoire</div>
        </div>
      </div>
    </div>

    <!-- Section Aéroport (OBLIGATOIRE) -->
    <div class="border-t pt-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Informations de l'Aéroport</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Nom de l'aéroport -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Nom de l'aéroport *</label>
          <input type="text" formControlName="aeroport.nom" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="Ex: Aéroport Charles de Gaulle">
          <div *ngIf="aeroportNom?.invalid && aeroportNom?.touched" class="text-red-600 text-sm mt-1">
            <div *ngIf="aeroportNom?.errors?.['required']">Le nom de l'aéroport est obligatoire</div>
          </div>
        </div>

        <!-- Code de l'aéroport -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Code de l'aéroport (3-4 lettres) *</label>
          <input type="text" formControlName="aeroport.code" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 uppercase"
                 placeholder="Ex: CDG" maxlength="4">
          <div *ngIf="aeroportCode?.invalid && aeroportCode?.touched" class="text-red-600 text-sm mt-1">
            <div *ngIf="aeroportCode?.errors?.['required']">Le code de l'aéroport est obligatoire</div>
            <div *ngIf="aeroportCode?.errors?.['pattern']">Le code doit contenir 3-4 lettres majuscules</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Informations de Vol -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Prix -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Prix (FCFA) *</label>
        <input type="number" formControlName="prix" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Ex: 250000">
        <div *ngIf="prix?.invalid && prix?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="prix?.errors?.['required']">Le prix est obligatoire</div>
          <div *ngIf="prix?.errors?.['pattern']">Le prix doit être un nombre</div>
        </div>
      </div>

      <!-- Durée du vol -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Durée du vol *</label>
        <input type="text" formControlName="dureeVol" 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Ex: 2h30">
        <div *ngIf="dureeVol?.invalid && dureeVol?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="dureeVol?.errors?.['required']">La durée du vol est obligatoire</div>
        </div>
      </div>

      <!-- Vols par semaine -->
      <div class="mt-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de vols par semaine *</label>
        <div class="relative rounded-md shadow-sm">
          <input type="number" formControlName="volsParSemaine" 
                min="1" max="100"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Ex: 7">
        </div>
        <div *ngIf="volsParSemaine?.invalid && (volsParSemaine?.dirty || volsParSemaine?.touched)" 
             class="mt-1 text-sm text-red-600">
          <div *ngIf="volsParSemaine?.errors?.['required']">Le nombre de vols est obligatoire</div>
          <div *ngIf="volsParSemaine?.errors?.['min']">Le nombre minimum est de 1</div>
          <div *ngIf="volsParSemaine?.errors?.['max']">Le nombre maximum est de 100</div>
        </div>
      </div>
    </div>

    <!-- Section Avion et Description -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Type d'avion -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Type d'avion *</label>
        <select formControlName="avion"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">Sélectionnez un avion</option>
          <option *ngFor="let avion of avionsDisponibles" [value]="avion">{{ avion }}</option>
        </select>
        <div *ngIf="avion?.invalid && avion?.touched" class="text-red-600 text-sm mt-1">
          <div *ngIf="avion?.errors?.['required']">Le type d'avion est obligatoire</div>
        </div>
      </div>

      <!-- Description -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
        <textarea formControlName="description" rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Description optionnelle de la destination"></textarea>
      </div>
    </div>

    <!-- Section Image -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Image de la destination *</label>
      <input type="file" id="image" (change)="onImageSelectionnee($event)" 
             accept="image/jpeg,image/jpg,image/png,image/webp"
             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
      
      <!-- Prévisualisation de l'image -->
      <div *ngIf="imagePreview" class="mt-4">
        <p class="text-sm text-gray-600 mb-2">Aperçu de l'image:</p>
        <img [src]="imagePreview" alt="Aperçu" class="max-w-xs h-auto rounded-lg shadow-md">
        <button type="button" (click)="supprimerImage()" 
                class="mt-2 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
          Supprimer l'image
        </button>
      </div>
    </div>

    <!-- Boutons -->
    <div class="flex justify-end space-x-4 pt-6">
      <!-- CORRECTION: Utilisation de la méthode publique annulerCreation() -->
      <button type="button" (click)="annulerCreation()" 
              class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
        Annuler
      </button>
      <button type="submit" [disabled]="chargement || destinationForm.invalid || !fichierImage"
              class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed">
        <span *ngIf="chargement">Création en cours...</span>
        <span *ngIf="!chargement">Créer la Destination</span>
      </button>
    </div>
  </form>
</div>