<!-- Section de réservation -->
<section class="section" id="booking">
    <div class="container">
        <div class="card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-plane-departure me-2"></i>
                    Réservez votre vol
                </h2>
                <p class="text-muted">Trouvez et réservez votre vol en quelques clics</p>
            </div>

            <!-- Barre de progression -->
            <div class="steps-container mb-4">
                <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
                    <div class="step-number">1</div>
                    <div class="step-label">Recherche</div>
                </div>
                <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
                    <div class="step-number">2</div>
                    <div class="step-label">Vols</div>
                </div>
                <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
                    <div class="step-number">3</div>
                    <div class="step-label">Voyageurs</div>
                </div>
                <div class="step" [class.active]="currentStep === 4" [class.completed]="currentStep > 4">
                    <div class="step-number">4</div>
                    <div class="step-label">Paiement</div>
                </div>
                <div class="step" [class.active]="currentStep === 5">
                    <div class="step-number">5</div>
                    <div class="step-label">Confirmation</div>
                </div>
            </div>

            <!-- Étape 1: Recherche de vol -->
            <div *ngIf="currentStep === 1" id="step-1" class="step-content">
                <h3 class="mb-4 text-center">Recherchez votre vol</h3>

                <!-- Recherches récentes -->
                <div *ngIf="recentSearches.length > 0" class="card mb-4">
                    <div class="card-body">
                        <h5 class="mb-3"><i class="fas fa-history me-2"></i>Recherches récentes</h5>
                        <div class="d-flex flex-wrap gap-3">
                            <div *ngFor="let search of recentSearches" class="recent-search-item p-3 border rounded" 
                                 (click)="useRecentSearch(search)" style="cursor: pointer;">
                                <div class="fw-bold text-primary">{{ getDestinationName(search.destination) }}</div>
                                <div class="text-muted small">{{ formatDate(search.departureDate) }}</div>
                                <div *ngIf="search.returnDate" class="text-muted small">
                                    Retour: {{ formatDate(search.returnDate) }}
                                </div>
                                <div class="mt-1">
                                    <span class="badge bg-secondary">
                                        {{ search.passengers }} {{ search.passengers > 1 ? 'voyageurs' : 'voyageur' }}
                                    </span>
                                    <span class="badge ms-1" 
                                          [ngClass]="{
                                            'bg-info text-dark': search.travelClass === 'economy',
                                            'bg-warning': search.travelClass === 'business',
                                            'bg-dark': search.travelClass === 'first'
                                          }">
                                        {{ search.travelClass === 'economy' ? 'Éco' : 
                                           search.travelClass === 'business' ? 'Affaires' : 'Première' }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <form (ngSubmit)="searchFlights(searchForm); $event.preventDefault()" #searchForm="ngForm" class="mt-4">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ville de départ</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light"><i class="fas fa-plane-departure"></i></span>
                                <input type="text" class="form-control" name="departure" [(ngModel)]="flightSearch.departure" value="NDJ" readonly>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ville de destination <span class="text-danger">*</span></label>
                            <div class="input-group" [class.is-invalid]="searchForm.submitted && (destination.invalid || !flightSearch.destination)">
                                <span class="input-group-text bg-light"><i class="fas fa-plane-arrival"></i></span>
                                <select class="form-select" id="destination" 
                                        [(ngModel)]="flightSearch.destination" 
                                        name="destination" 
                                        required
                                        (ngModelChange)="updateDestinationCode()"
                                        #destination="ngModel">
                                    <option value="">Sélectionnez une destination</option>
                                    <option *ngFor="let dest of destinations" [value]="dest.name">
                                        {{ dest.name }} ({{ dest.code }})
                                    </option>
                                </select>
                            </div>
                            <div *ngIf="searchForm.submitted && destination.invalid" class="invalid-feedback d-block">
                                Veuillez sélectionner une destination
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date de départ <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text bg-light"><i class="far fa-calendar-alt"></i></span>
                                <input type="date" class="form-control" 
                                       [(ngModel)]="flightSearch.departureDate" 
                                       name="departureDate" 
                                       [min]="today"
                                       required>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date de retour (optionnel)</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light"><i class="far fa-calendar-alt"></i></span>
                                <input type="date" class="form-control" 
                                       [(ngModel)]="flightSearch.returnDate" 
                                       name="returnDate"
                                       [min]="flightSearch.departureDate || today">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Passagers <span class="text-danger">*</span></label>
                            <div class="input-group" [class.is-invalid]="searchForm.submitted && (passengers.invalid || flightSearch.passengers === 0)">
                                <span class="input-group-text bg-light"><i class="fas fa-users"></i></span>
                                <select class="form-select" 
                                        [(ngModel)]="flightSearch.passengers" 
                                        name="passengers" 
                                        #passengers="ngModel"
                                        required
                                        [class.is-invalid]="searchForm.submitted && (passengers.invalid || flightSearch.passengers === 0)">
                                    <option [ngValue]="0" disabled>Sélectionnez le nombre</option>
                                    <option *ngFor="let i of [1,2,3,4,5,6,7,8,9]" [ngValue]="i">
                                        {{ i }} {{ i > 1 ? 'voyageurs' : 'voyageur' }}
                                    </option>
                                </select>
                            </div>
                            <div *ngIf="searchForm.submitted && (passengers.invalid || flightSearch.passengers === 0)" class="invalid-feedback d-block">
                                Veuillez sélectionner le nombre de passagers
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Classe <span class="text-danger">*</span></label>
                            <div class="input-group" [class.is-invalid]="searchForm.submitted && (travelClass.invalid || !flightSearch.travelClass)">
                                <span class="input-group-text bg-light"><i class="fas fa-chair"></i></span>
                                <select class="form-select" 
                                        [(ngModel)]="flightSearch.travelClass" 
                                        name="travelClass" 
                                        #travelClass="ngModel"
                                        required>
                                    <option value="">Sélectionnez une classe</option>
                                    <option value="economy">Économique</option>
                                    <option value="business">Affaires</option>
                                    <option value="first">Première classe</option>
                                </select>
                            </div>
                            <div *ngIf="searchForm.submitted && travelClass.invalid" class="invalid-feedback d-block">
                                Veuillez sélectionner une classe
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <button type="button" class="btn btn-primary btn-lg" (click)="searchFlights(searchForm)">
                            Rechercher des vols <i class="fas fa-search ms-2"></i>
                        </button>
                    </div>
                </form>
            </div>
