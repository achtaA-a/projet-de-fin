<div class="reservation-container">
    <!-- Indicateur d'√©tapes -->
    <div class="steps-indicator">
      <div [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <span>1</span> Recherche
      </div>
      <div [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <span>2</span> Vols
      </div>
      <div [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
        <span>3</span> Passagers
      </div>
      <div [class.active]="currentStep === 4" [class.completed]="currentStep > 4">
        <span>4</span> Paiement
      </div>
      <div [class.active]="currentStep === 5">
        <span>5</span> Confirmation
      </div>
    </div>
  
    <!-- Afficher la destination s√©lectionn√©e -->
    <div *ngIf="destinationSelectionnee && currentStep === 1" class="selected-destination-alert">
      <div class="alert alert-info">
        <h6>üéØ Destination s√©lectionn√©e :</h6>
        <div class="destination-info">
          <strong>{{ destinationSelectionnee.nom }} ({{ destinationSelectionnee.code }})</strong>
          <br>
          <small>Dur√©e du vol: {{ destinationSelectionnee.dureeVol }} ‚Ä¢ √Ä partir de {{ destinationSelectionnee.prix }} FCFA</small>
        </div>
      </div>
    </div>
  
    <!-- √âtape 1 : Recherche de vols -->
    <div *ngIf="currentStep === 1" class="step-container">
      <h3>Rechercher un vol</h3>
      
      <div *ngIf="chargement" class="loading">Chargement des destinations...</div>
  
      <form #searchForm="ngForm" (ngSubmit)="searchFlights(searchForm)" *ngIf="!chargement">
        <!-- MODIFICATION: S√©lection du point de d√©part -->
        <div class="form-group">
          <label>D√©part *</label>
          <select 
            [(ngModel)]="flightSearch.departure" 
            name="departure" 
            required 
            class="form-control"
            (change)="onDepartureChange()">
            <option value="">S√©lectionnez un point de d√©part</option>
            <option *ngFor="let aeroport of aeroportsDepart" [value]="aeroport.code">
              {{ aeroport.code }} - {{ aeroport.ville }} ({{ aeroport.pays }})
            </option>
          </select>
          <small class="form-text text-muted">Choisissez votre a√©roport de d√©part</small>
        </div>
  
        <div class="form-group">
          <label>Destination *</label>
          <select 
            [(ngModel)]="flightSearch.destination" 
            name="destination" 
            required 
            class="form-control"
            (change)="onDestinationChange()">
            <option value="">S√©lectionnez une destination</option>
            <option *ngFor="let dest of destinations" [value]="dest.code" 
                    [disabled]="dest.code === flightSearch.departure">
              {{ dest.nom }} ({{ dest.code }})
            </option>
          </select>
          <small class="form-text text-muted" *ngIf="flightSearch.departure">
            Vols disponibles depuis {{ getDepartureName(flightSearch.departure) }}
          </small>
        </div>
  
        <div class="form-row">
          <div class="form-group">
            <label>Date de d√©part *</label>
            <input 
              type="date" 
              [(ngModel)]="flightSearch.departureDate" 
              name="departureDate" 
              [min]="today"
              required 
              class="form-control">
          </div>
  
          <div class="form-group">
            <label>Date de retour</label>
            <input 
              type="date" 
              [(ngModel)]="flightSearch.returnDate" 
              name="returnDate" 
              [min]="flightSearch.departureDate || today"
              class="form-control">
          </div>
        </div>
  
        <div class="form-row">
          <div class="form-group">
            <label>Passagers</label>
            <select 
              [(ngModel)]="flightSearch.passengers" 
              name="passengers" 
              class="form-control"
              (change)="onPassengersChange()">
              <option *ngFor="let i of [1,2,3,4,5,6]" [value]="i">{{ i }} passager(s)</option>
            </select>
          </div>
  
          <div class="form-group">
            <label>Classe</label>
            <select 
              [(ngModel)]="flightSearch.travelClass" 
              name="travelClass" 
              class="form-control"
              (change)="onClassChange()">
              <option value="economy">√âconomique</option>
              <option value="business">Affaires</option>
              <option value="first">Premi√®re</option>
            </select>
          </div>
        </div>
  
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="searchForm.invalid">
            Rechercher les vols
          </button>
        </div>
      </form>
    </div>
  
    <!-- √âtape 3 : Informations des passagers -->
    <div *ngIf="currentStep === 3" class="step-container">
      <h3>Informations des passagers</h3>
      <p class="price-info">Prix total: <strong>{{ prixTotal | currency:'XAF':'symbol':'1.0-0' }}</strong></p>
      
      <form #passagerForm="ngForm">
        <div *ngFor="let p of passagers; let i = index" class="passager-card">
          <h5>Passager {{ i + 1 }} {{ i === 0 ? '(Adulte)' : '' }}</h5>
          
          <div class="form-row">
            <div class="form-group">
              <label>Pr√©nom *</label>
              <input 
                type="text" 
                [(ngModel)]="p.prenom" 
                [name]="'prenom' + i" 
                required 
                class="form-control"
                placeholder="Pr√©nom">
            </div>
            
            <div class="form-group">
              <label>Nom *</label>
              <input 
                type="text" 
                [(ngModel)]="p.nom" 
                [name]="'nom' + i" 
                required 
                class="form-control"
                placeholder="Nom">
            </div>
          </div>
  
          <div class="form-row">
            <div class="form-group">
              <label>Date de naissance *</label>
              <input 
                type="date" 
                [(ngModel)]="p.dateNaissance" 
                [name]="'dateNaissance' + i" 
                required 
                [max]="today"
                class="form-control">
            </div>
            
            <div class="form-group">
              <label>Num√©ro de passeport *</label>
              <input 
                type="text" 
                [(ngModel)]="p.numeroPasseport" 
                [name]="'passeport' + i" 
                required 
                class="form-control"
                placeholder="Num√©ro de passeport">
            </div>
          </div>
        </div>
  
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="precedent()">
            Retour
          </button>
          <button type="button" class="btn btn-primary" (click)="validerPassagers()">
            Continuer
          </button>
        </div>
      </form>
    </div>
  
    <!-- √âtape 4 : Confirmation -->
    <div *ngIf="currentStep === 4" class="step-container">
      <h3>Confirmation de r√©servation</h3>
      
      <div class="reservation-summary">
        <h5>D√©tails du vol</h5>
        <p><strong>D√©part:</strong> {{ getDepartureName(flightSearch.departure) }}</p>
        <p><strong>Destination:</strong> {{ getDestinationName(flightSearch.destination) }}</p>
        <p><strong>Date de d√©part:</strong> {{ formatDate(flightSearch.departureDate) }}</p>
        <p *ngIf="flightSearch.returnDate"><strong>Date de retour:</strong> {{ formatDate(flightSearch.returnDate) }}</p>
        <p><strong>Passagers:</strong> {{ flightSearch.passengers }}</p>
        <p><strong>Classe:</strong> {{ flightSearch.travelClass }}</p>
        <p><strong>Prix total:</strong> {{ prixTotal | currency:'XAF':'symbol':'1.0-0' }}</p>
      </div>
  
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="precedent()">
          Retour
        </button>
        <button type="button" class="btn btn-success" (click)="creerReservation()">
          Confirmer la r√©servation
        </button>
      </div>
    </div>
  
    <!-- √âtape 5 : Confirmation finale -->
    <div *ngIf="currentStep === 5" class="step-container confirmation">
      <div class="confirmation-icon">‚úì</div>
      <h3>R√©servation confirm√©e !</h3>
      <p>Merci pour votre r√©servation. Vous recevrez un email de confirmation sous peu.</p>
      <button type="button" class="btn btn-primary" routerLink="/">
        Retour √† l'accueil
      </button>
    </div>
  </div>