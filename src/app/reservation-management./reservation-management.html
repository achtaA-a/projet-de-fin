<div class="management-container">
  <!-- En-tÃªte avec statistiques -->
  <div class="management-header">
    <div class="header-content">
      <div class="title-section">
        <div class="title-icon">
          <i class="icon">ğŸ“‹</i>
        </div>
        <div class="title-text">
          <h1>Gestion des RÃ©servations</h1>
          <p class="subtitle">GÃ©rez et suivez toutes les rÃ©servations de vols</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="loadReservations()" [disabled]="loading">
          <i class="reload-icon" [class.spinning]="loading">ğŸ”„</i>
          {{ loading ? 'Chargement...' : 'Actualiser' }}
        </button>
        <button class="btn btn-primary" (click)="exportToCSV()" [disabled]="reservations.length === 0">
          <i>ğŸ“Š</i>
          Exporter CSV
        </button>
      </div>
    </div>

    <!-- Cartes de statistiques -->
    <div *ngIf="stats" class="stats-grid">
      <div class="stat-card">
        <div class="stat-card-content">
          <div class="stat-icon total">
            <i>ğŸ“Š</i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ stats.totalReservations || 0 }}</span>
            <span class="stat-label">RÃ©servations totales</span>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-card-content">
          <div class="stat-icon revenue">
            <i>ğŸ’°</i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ (stats.chiffreAffaire || 0) | number:'1.0-0' }} FCFA</span>
            <span class="stat-label">Chiffre d'affaires</span>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-card-content">
          <div class="stat-icon average">
            <i>ğŸ“ˆ</i>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ (stats.moyenneParReservation || 0) | number:'1.0-0' }} FCFA</span>
            <span class="stat-label">Moyenne par rÃ©servation</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau des rÃ©servations -->
  <div class="table-section">
    <div class="table-header">
      <div class="table-title">
        <h2>Liste des RÃ©servations</h2>
        <span class="table-subtitle">Gestion complÃ¨te des rÃ©servations de vols</span>
      </div>
      <div class="table-controls">
        <div class="search-container">
          <div class="search-box">
            <i class="search-icon">ğŸ”</i>
            <input type="text" 
                   placeholder="Rechercher une rÃ©servation, passager, destination..." 
                   [(ngModel)]="searchTerm" 
                   (input)="currentPage = 1"
                   class="search-input">
            <button *ngIf="searchTerm" 
                    class="clear-search-btn" 
                    (click)="clearSearch()" 
                    title="Effacer la recherche">
              <i>âœ•</i>
            </button>
          </div>
        </div>
        
        <div class="table-info">
          <span class="results-count">{{ filteredReservations.length }} rÃ©sultat(s)</span>
          <div class="pagination-info">
            Page {{ currentPage }} sur {{ totalPages }}
          </div>
        </div>
      </div>
    </div>

    <!-- Ã‰tat de chargement -->
    <div *ngIf="loading" class="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">
        <h3>Chargement des rÃ©servations</h3>
        <p>Veuillez patienter pendant que nous rÃ©cupÃ©rons vos donnÃ©es...</p>
      </div>
    </div>

    <!-- Tableau des rÃ©sultats -->
    <div *ngIf="!loading && filteredReservations.length > 0" class="table-wrapper">
      <div class="table-responsive">
        <table class="reservations-table">
          <thead>
            <tr>
              <th class="reference-col">RÃ©fÃ©rence</th>
              <th class="departure-col">DÃ©part</th>
              <th class="destination-col">Destination</th>
              <th class="passengers-col">Passagers</th>
              <th class="names-col">Noms des Passagers</th>
              <th class="price-col">Prix Total</th>
              <th class="date-col">Date de crÃ©ation</th>
              <th class="status-col">Statut</th>
              <th class="actions-col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of filteredReservations" class="reservation-row">
              <td class="reference-cell">
                <div class="reference-badge">
                  <strong>{{ r.referenceReservation }}</strong>
                </div>
              </td>
              <td class="departure-cell">
                <span class="airport-code">{{ r.depart }}</span>
              </td>
              <td class="destination-cell">
                <div class="destination-info">
                  <strong class="city-name">{{ r.destinationId?.nom || 'N/A' }}</strong>
                  <span class="airport-code">{{ r.destinationId?.code || r.vol?.destination }}</span>
                </div>
              </td>
              <td class="passengers-count-cell">
                <div class="passengers-badge">
                  <span class="passengers-count">{{ r.passagers?.length || 0 }}</span>
                  <i class="passengers-icon">ğŸ‘¥</i>
                </div>
              </td>
              <td class="passengers-names-cell">
                <div class="passengers-list">
                  <div *ngFor="let passager of r.passagers?.slice(0, 2)" class="passenger-item">
                    <span class="passenger-name">{{ passager.prenom }} {{ passager.nom }}</span>
                  </div>
                  <div *ngIf="r.passagers?.length > 2" class="more-passengers">
                    <span class="more-count">+{{ r.passagers.length - 2 }} autre(s)</span>
                  </div>
                  <div *ngIf="!r.passagers || r.passagers.length === 0" class="no-passengers">
                    <span class="no-data">Aucun passager</span>
                  </div>
                </div>
              </td>
              <td class="price-cell">
                <div class="price-amount">
                  <strong>{{ r.prixTotal | number:'1.0-0' }} FCFA</strong>
                </div>
              </td>
              <td class="date-cell">
                <div class="date-info">
                  <span class="date">{{ r.createdAt | date:'dd/MM/yyyy' }}</span>
                  <span class="time">{{ r.createdAt | date:'HH:mm' }}</span>
                </div>
              </td>
              <td class="status-cell">
                <div class="status-container">
                  <select [(ngModel)]="r.statut" 
                          (change)="updateReservationStatus(r._id, r.statut)"
                          class="status-select"
                          [class]="getStatusClass(r.statut)"
                          [disabled]="r.saving">
                    <option value="en_attente">En attente</option>
                    <option value="confirmÃ©e">ConfirmÃ©e</option>
                    <option value="annulÃ©e">AnnulÃ©e</option>
                  </select>
                  <div class="status-saving" *ngIf="r.saving">
                    <div class="mini-spinner"></div>
                  </div>
                </div>
              </td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <button class="btn-action btn-view" (click)="viewReservation(r._id)" title="Voir les dÃ©tails">
                    <i class="action-icon">ğŸ‘ï¸</i>
                    <span class="action-text">DÃ©tails</span>
                  </button>
                  <button class="btn-action btn-edit" (click)="editReservation(r._id)" title="Modifier">
                    <i class="action-icon">âœï¸</i>
                    <span class="action-text">Modifier</span>
                  </button>
                  <button class="btn-action btn-delete" (click)="deleteReservation(r._id)" title="Supprimer">
                    <i class="action-icon">ğŸ—‘ï¸</i>
                    <span class="action-text">Supprimer</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Ã‰tat vide -->
    <div *ngIf="!loading && filteredReservations.length === 0 && searchTerm" class="empty-state">
      <div class="empty-icon">
        <i>ğŸ”</i>
      </div>
      <div class="empty-content">
        <h3>Aucun rÃ©sultat trouvÃ©</h3>
        <p>Aucune rÃ©servation ne correspond Ã  votre recherche "{{ searchTerm }}"</p>
        <button class="btn btn-outline" (click)="clearSearch()">Effacer la recherche</button>
      </div>
    </div>

    <div *ngIf="!loading && reservations.length === 0 && !searchTerm" class="empty-state">
      <div class="empty-icon">
        <i>ğŸ“­</i>
      </div>
      <div class="empty-content">
        <h3>Aucune rÃ©servation trouvÃ©e</h3>
        <p>Il n'y a actuellement aucune rÃ©servation dans le systÃ¨me.</p>
        <button class="btn btn-primary" (click)="loadReservations()">Actualiser</button>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="filteredReservations.length > 0" class="pagination-container">
      <div class="pagination-info">
        Affichage de {{ getStartIndex() + 1 }} Ã  {{ getEndIndex() }} sur {{ filteredReservations.length }} rÃ©sultat(s)
      </div>
      <div class="pagination-controls">
        <button class="btn-pagination" 
                [disabled]="currentPage === 1" 
                (click)="previousPage()">
          <i>â€¹</i>
          PrÃ©cÃ©dent
        </button>
        
        <div class="page-numbers">
          <span class="current-page">{{ currentPage }}</span>
          <span class="page-separator">sur</span>
          <span class="total-pages">{{ totalPages }}</span>
        </div>
        
        <button class="btn-pagination" 
                [disabled]="currentPage === totalPages" 
                (click)="nextPage()">
          Suivant
          <i>â€º</i>
        </button>
      </div>
    </div>
  </div>
</div>