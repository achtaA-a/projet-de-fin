<div class="management-container">
  <!-- En-tête avec statistiques -->
  <div class="management-header">
    <div class="header-content">
      <div class="title-section">
        <i class="icon">📋</i>
        <h1>Gestion des Réservations</h1>
        <p class="subtitle">Gérez et suivez toutes les réservations de vols</p>
      </div>
      <div class="header-actions">
        <button class="reload-btn" (click)="loadReservations()" [disabled]="loading">
          <i class="reload-icon">🔄</i>
          {{ loading ? 'Chargement...' : 'Actualiser' }}
        </button>
        <button class="export-btn" (click)="exportToCSV()" [disabled]="reservations.length === 0">
          <i>📊</i>
          Exporter CSV
        </button>
      </div>
    </div>

    <!-- Cartes de statistiques -->
    <div *ngIf="stats" class="stats-cards">
      <div class="stat-card total">
        <div class="stat-icon">📊</div>
        <div class="stat-info">
          <span class="stat-value">{{ stats.totalReservations || 0 }}</span>
          <span class="stat-label">Réservations totales</span>
        </div>
      </div>
      <div class="stat-card revenue">
        <div class="stat-icon">💰</div>
        <div class="stat-info">
          <span class="stat-value">{{ (stats.chiffreAffaire || 0) | number:'1.0-0' }} FCFA</span>
          <span class="stat-label">Chiffre d'affaires</span>
        </div>
      </div>
      <div class="stat-card average">
        <div class="stat-icon">📈</div>
        <div class="stat-info">
          <span class="stat-value">{{ (stats.moyenneParReservation || 0) | number:'1.0-0' }} FCFA</span>
          <span class="stat-label">Moyenne par réservation</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau des réservations -->
  <div class="table-container">
    <div class="table-header">
      <h3>Liste des Réservations</h3>
      <div class="table-actions">
        <div class="search-box">
          <input type="text" placeholder="Rechercher une réservation, passager..." 
                 [(ngModel)]="searchTerm" 
                 (input)="currentPage = 1">
          <i class="search-icon">🔍</i>
          <button *ngIf="searchTerm" class="clear-search" (click)="clearSearch()" title="Effacer la recherche">
            ✕
          </button>
        </div>
        <div class="results-info">
          {{ filteredReservations.length }} résultat(s) trouvé(s)
        </div>
      </div>
    </div>

    <!-- État de chargement -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <span>Chargement des réservations...</span>
    </div>

    <!-- Tableau des résultats -->
    <div *ngIf="!loading && filteredReservations.length > 0" class="table-wrapper">
      <table class="reservations-table">
        <thead>
          <tr>
            <th>Référence</th>
            <th>Départ</th>
            <th>Destination</th>
            <th>Passagers</th>
            <th>Noms des Passagers</th>
            <th>Prix Total</th>
            <th>Date de création</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of filteredReservations" class="reservation-row">
            <td class="reference-cell">
              <strong>{{ r.referenceReservation }}</strong>
            </td>
            <td>
              <span class="airport-code">{{ r.depart }}</span>
            </td>
            <td>
              <div class="destination-info">
                <strong>{{ r.destinationId?.nom || 'N/A' }}</strong>
                <small>{{ r.destinationId?.code || r.vol?.destination }}</small>
              </div>
            </td>
            <td>
              <span class="passengers-badge">{{ r.passagers?.length || 0 }}</span>
            </td>
            <td class="passengers-names">
              <div class="passengers-list">
                <div *ngFor="let passager of r.passagers?.slice(0, 2)" class="passager-name">
                  {{ passager.prenom }} {{ passager.nom }}
                </div>
                <div *ngIf="r.passagers?.length > 2" class="more-passagers">
                  +{{ r.passagers.length - 2 }} autre(s)
                </div>
                <div *ngIf="!r.passagers || r.passagers.length === 0" class="no-passagers">
                  Aucun passager
                </div>
              </div>
            </td>
            <td class="price-cell">
              <strong>{{ r.prixTotal | number:'1.0-0' }} FCFA</strong>
            </td>
            <td class="date-cell">
              {{ r.createdAt | date:'dd/MM/yyyy' }}
              <small>{{ r.createdAt | date:'HH:mm' }}</small>
            </td>
            <td class="status-cell">
              <select [(ngModel)]="r.statut" 
                      (change)="updateReservationStatus(r._id, r.statut)"
                      class="status-select"
                      [class]="getStatusClass(r.statut)">
                <option value="en_attente">En attente</option>
                <option value="confirmée">Confirmée</option>
                <option value="annulée">Annulée</option>
              </select>
              <div class="status-saving" *ngIf="r.saving">
                <div class="mini-spinner"></div>
              </div>
            </td>
            <td class="actions-cell">
              <button class="btn-view" (click)="viewReservation(r._id)" title="Voir les détails">
                <i>👁️</i>
                Détails
              </button>
              <button class="btn-edit" (click)="editReservation(r._id)" title="Modifier">
                <i>✏️</i>
                Modifier
              </button>
              <button class="btn-delete" (click)="deleteReservation(r._id)" title="Supprimer">
                <i>🗑️</i>
                Supprimer
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- État vide -->
    <div *ngIf="!loading && filteredReservations.length === 0 && searchTerm" class="empty-state">
      <div class="empty-icon">🔍</div>
      <h3>Aucun résultat trouvé</h3>
      <p>Aucune réservation ne correspond à votre recherche "{{ searchTerm }}"</p>
      <button class="clear-search-btn" (click)="clearSearch()">Effacer la recherche</button>
    </div>

    <div *ngIf="!loading && reservations.length === 0 && !searchTerm" class="empty-state">
      <div class="empty-icon">📭</div>
      <h3>Aucune réservation trouvée</h3>
      <p>Il n'y a actuellement aucune réservation dans le système.</p>
    </div>

    <!-- Pagination -->
    <div *ngIf="filteredReservations.length > 0" class="pagination">
      <div class="pagination-info">
        Page {{ currentPage }} sur {{ totalPages }} ({{ filteredReservations.length }} résultat(s))
      </div>
      <div class="pagination-controls">
        <button class="pagination-btn" [disabled]="currentPage === 1" (click)="previousPage()">
          ‹ Précédent
        </button>
        <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
          Suivant ›
        </button>
      </div>
    </div>

   
    </div>
  