<!-- Section des informations voyageurs -->
<section class="voyageur-section">
  <div class="voyageur-container">
    <!-- Header avec style uniforme -->
    <div class="voyageur-header">
      <div class="header-content">
        <div class="progress-indicator">
          <div class="step-badge">
            <i class="fas fa-users"></i>
            <span>Étape 3/5</span>
          </div>
          <div class="progress-text">
            <h2>Informations des passagers</h2>
            <p>Renseignez les détails de chaque voyageur</p>
          </div>
        </div>
        <div class="header-decoration">
          <div class="decoration-line"></div>
          <i class="fas fa-plane decoration-icon"></i>
          <div class="decoration-line"></div>
        </div>
      </div>
    </div>

    <!-- Alerte d'information -->
    <div class="alert-modern">
      <div class="alert-icon">
        <i class="fas fa-info-circle"></i>
      </div>
      <div class="alert-content">
        <h4>Informations importantes</h4>
        <p>Tous les champs marqués d'un astérisque (*) sont obligatoires. Assurez-vous que les informations correspondent exactement à vos documents d'identité.</p>
      </div>
    </div>

    <!-- Section des passagers -->
    <div class="passengers-section">
      <!-- Carte de chaque passager -->
      <div *ngFor="let passenger of passengers; let i = index" class="passenger-card">
        <!-- En-tête du passager -->
        <div class="passenger-header">
          <div class="passenger-title">
            <div class="passenger-number">{{ i + 1 }}</div>
            <div class="passenger-type">
              <span class="type-label">{{ getPassengerTypeLabel(passenger.type) }}</span>
              <div class="type-indicator"
                   [class.adult]="passenger.type === 'M.'"
                   [class.child]="passenger.type === 'Mme'"
                   [class.infant]="passenger.type === 'Mlle'">
              </div>
            </div>
          </div>
          <div class="passenger-actions">
            <button class="btn-remove"
                    (click)="removePassenger(i)"
                    type="button"
                    title="Supprimer ce passager">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>

        <!-- Formulaire du passager -->
        <div class="passenger-form">
          <!-- Ligne 1: Civilité, Nom, Prénom -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label required">Civilité</label>
              <select class="modern-select"
                      [(ngModel)]="passenger.type"
                      name="type{{i}}"
                      required>
                <option value="M.">Monsieur</option>
                <option value="Mme">Madame</option>
                <option value="Mlle">Mademoiselle</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label required">Nom de famille</label>
              <input type="text"
                     class="modern-input"
                     [class.is-invalid]="!passenger.lastName?.trim()"
                     [(ngModel)]="passenger.lastName"
                     placeholder="Entrez votre nom"
                     required>
              <div class="validation-error" *ngIf="!passenger.lastName?.trim()">
                Le nom de famille est requis
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">Prénom(s)</label>
              <input type="text"
                     class="modern-input"
                     [class.is-invalid]="!passenger.firstName?.trim()"
                     [(ngModel)]="passenger.firstName"
                     placeholder="Entrez votre prénom"
                     required>
              <div class="validation-error" *ngIf="!passenger.firstName?.trim()">
                Le prénom est requis
              </div>
            </div>
          </div>

          <!-- Ligne 2: Date de naissance, Nationalité, Document -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label required">Date de naissance</label>
              <input type="date"
                     class="modern-input"
                     [max]="today"
                     [(ngModel)]="passenger.dateOfBirth"
                     required>
            </div>

            <div class="form-group">
              <label class="form-label required">Nationalité</label>
              <select class="modern-select"
                      [(ngModel)]="passenger.nationality"
                      required>
                <option value="">Choisir un pays</option>
                <option *ngFor="let country of countries" [value]="country.code">
                  {{ country.name }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label required">Numéro de passeport / CNI</label>
              <input type="text"
                     class="modern-input"
                     [(ngModel)]="passenger.passportNumber"
                     placeholder="Numéro du document"
                     required>
            </div>
          </div>

          <!-- Ligne 3: Email, Téléphone -->
          <div class="form-row">
            <div class="form-group">
              <label class="form-label required">Adresse email</label>
              <input type="email"
                     class="modern-input"
                     [class.is-invalid]="!passenger.email?.trim() || (passenger.email && !isValidEmail(passenger.email))"
                     [(ngModel)]="passenger.email"
                     placeholder="votre.email@exemple.com"
                     required>
              <div class="validation-error" *ngIf="!passenger.email?.trim()">
                L'adresse email est requise
              </div>
              <div class="validation-error" *ngIf="passenger.email && !isValidEmail(passenger.email)">
                Format d'email invalide
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">Numéro de téléphone</label>
              <input type="tel"
                     class="modern-input"
                     [class.is-invalid]="!passenger.phone?.trim() || (passenger.phone && !isValidPhone(passenger.phone))"
                     [(ngModel)]="passenger.phone"
                     placeholder="+261 XX XX XXX XX"
                     required>
              <div class="validation-error" *ngIf="!passenger.phone?.trim()">
                Le numéro de téléphone est requis
              </div>
              <div class="validation-error" *ngIf="passenger.phone && !isValidPhone(passenger.phone)">
                Format de téléphone invalide (minimum 10 chiffres)
              </div>
            </div>
          </div>

          <!-- Section programme de fidélité (pour les hommes) -->
          <div *ngIf="passenger.type === 'M.'" class="frequent-flyer-section">
            <div class="checkbox-container">
              <input type="checkbox"
                     [(ngModel)]="passenger.frequentFlyer"
                     id="frequentFlyer{{i}}">
              <span class="checkmark"></span>
              <label class="form-label" [for]="'frequentFlyer' + i">Programme de fidélité (optionnel)</label>
            </div>

            <div *ngIf="passenger.frequentFlyer" class="frequent-flyer-form">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Compagnie aérienne</label>
                  <input type="text"
                         class="modern-input"
                         [(ngModel)]="passenger.ffAirline"
                         placeholder="Ex: Air France, Turkish Airlines...">
                </div>

                <div class="form-group">
                  <label class="form-label">Numéro de membre</label>
                  <input type="text"
                         class="modern-input"
                         [(ngModel)]="passenger.ffNumber"
                         placeholder="Numéro de carte de fidélité">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bouton d'ajout de passager -->
      <div class="add-passenger-section">
        <button class="btn-add-passenger" (click)="addPassenger()">
          <i class="fas fa-plus-circle"></i>
          <span>Ajouter un passager</span>
        </button>
      </div>
    </div>

    <!-- Navigation -->
    <div class="voyageur-navigation">
      <button class="btn-nav btn-previous" (click)="previousStep()">
        <i class="fas fa-arrow-left"></i>
        <span>Retour</span>
      </button>

      <div class="navigation-center">
        <div class="passenger-counter">
          <i class="fas fa-users"></i>
          <span>{{ passengers.length }} voyageur{{ passengers.length > 1 ? 's' : '' }}</span>
        </div>
        <div class="form-status" [class.valid]="isFormValid()" [class.invalid]="!isFormValid()">
          <i class="fas" [class.fa-check]="isFormValid()" [class.fa-exclamation]="!isFormValid()"></i>
          {{ isFormValid() ? 'Formulaire complet ✓' : 'Formulaire incomplet' }}
        </div>
      </div>

      <button class="btn-nav btn-next"
              (click)="validatePassengers()"
              [disabled]="!isFormValid()"
              [class.form-ready]="isFormValid()"
              [title]="!isFormValid() ? 'Remplissez tous les champs obligatoires pour continuer' : 'Continuer vers le paiement'">
        <span>{{ isFormValid() ? 'Continuer ✓' : 'Continuer' }}</span>
        <i class="fas fa-arrow-right"></i>
      </button>
    </div>
  </div>
</section>
