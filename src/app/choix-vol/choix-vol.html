<div class="flight-selection-container">
  <!-- Header avec informations de recherche -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">
        <i class="fas fa-plane-departure me-3"></i>
        Choisissez votre vol
      </h1>
      <p class="hero-subtitle">Sélectionnez le vol qui correspond le mieux à vos besoins</p>
    </div>
  </div>

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Recherche des vols disponibles...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="error" class="error-container">
    <div class="error-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <h4>Erreur de recherche</h4>
    <p>{{error}}</p>
    <button class="btn btn-retry" (click)="loadFlights()">
      <i class="fas fa-refresh me-2"></i>Réessayer
    </button>
  </div>

  <!-- Section principale -->
  <div *ngIf="!isLoading && !error" class="main-content">
    <!-- Options de sélection -->
    <div class="selection-options">
      <!-- Type de voyage -->
      <div class="option-group">
        <h4><i class="fas fa-route me-2"></i>Type de voyage</h4>
        <div class="trip-type-buttons">
          <button class="btn btn-trip-type" 
                  [class.active]="tripType === 'oneway'"
                  (click)="setTripType('oneway')">
            <i class="fas fa-plane me-1"></i>Aller simple
          </button>
          <button class="btn btn-trip-type" 
                  [class.active]="tripType === 'roundtrip'"
                  (click)="setTripType('roundtrip')">
            <i class="fas fa-exchange-alt me-1"></i>Aller-retour
          </button>
        </div>
      </div>

      <!-- Services supplémentaires -->
      <div class="option-group">
        <h4><i class="fas fa-concierge-bell me-2"></i>Services supplémentaires</h4>
        <div class="services-grid">
          <div *ngFor="let service of availableServices" 
               class="service-option"
               [class.selected]="isServiceSelected(service.id)"
               (click)="toggleService(service.id)">
            <div class="service-icon">
              <i [class]="service.icon"></i>
            </div>
            <div class="service-info">
              <div class="service-name">{{service.name}}</div>
              <div class="service-price">{{service.price.toLocaleString()}} XAF</div>
            </div>
            <div class="service-check">
              <i class="fas fa-check" *ngIf="isServiceSelected(service.id)"></i>
            </div>
          </div>
        </div>
        <div class="services-total" *ngIf="selectedServices.length > 0">
          <strong>Total services: {{getTotalServicesPrice().toLocaleString()}} XAF</strong>
        </div>
      </div>

      <!-- Comparaison de vols -->
      <div class="option-group">
        <h4><i class="fas fa-balance-scale me-2"></i>Comparaison de vols</h4>
        <div class="comparison-controls">
          <button class="btn btn-comparison" 
                  [class.active]="showComparison"
                  (click)="toggleComparison()">
            <i class="fas fa-balance-scale me-1"></i>
            Comparer ({{comparisonFlights.length}}/3)
          </button>
          <button class="btn btn-clear" 
                  *ngIf="comparisonFlights.length > 0"
                  (click)="clearComparison()">
            <i class="fas fa-trash me-1"></i>Effacer
          </button>
        </div>
      </div>
    </div>

    <!-- Informations de recherche -->
    <div class="search-info">
      <div class="info-card">
        <i class="fas fa-info-circle text-blue-600 me-2"></i>
        Vols au départ de N'Djamena (NDJ) vers {{getDestinationCity()}}
        <span *ngIf="tripType === 'roundtrip'" class="trip-type-badge">Aller-retour</span>
      </div>
    </div>

    <!-- Liste des vols -->
    <div class="flights-section">
      <!-- Vols aller -->
      <div class="flight-category" *ngIf="hasDepartureFlights()">
        <h3 class="category-title">
          <i class="fas fa-plane-departure me-2"></i>Vols aller
        </h3>
        <div class="flights-list">
          <div *ngFor="let flight of getDepartureFlights()" 
               class="flight-card"
               [class.selected]="selectedFlight?.id === flight.id"
               (click)="selectFlight(flight)">
            
            <div class="flight-content">
              <div class="flight-main">
                <div class="flight-times">
                  <h4 class="flight-time">{{flight.departureTime}} - {{flight.arrivalTime}}</h4>
                  <p class="flight-route">{{flight.departure}} - {{flight.arrival}} • {{flight.duration}} • Direct</p>
                  <p class="flight-details">{{flight.airline}} • {{flight.aircraft}}</p>
                  
                  <!-- Services inclus -->
                  <div class="flight-services" *ngIf="flight.services">
                    <span class="service-badge" *ngIf="flight.services.meal">
                      <i class="fas fa-utensils"></i>Repas
                    </span>
                    <span class="service-badge" *ngIf="flight.services.wifi">
                      <i class="fas fa-wifi"></i>WiFi
                    </span>
                    <span class="service-badge" *ngIf="flight.services.entertainment">
                      <i class="fas fa-tv"></i>Divertissement
                    </span>
                    <span class="service-badge" *ngIf="flight.services.priorityBoarding">
                      <i class="fas fa-fast-forward"></i>Embarquement prioritaire
                    </span>
                    <span class="service-badge" *ngIf="flight.services.extraLegroom">
                      <i class="fas fa-chair"></i>Espace supplémentaire
                    </span>
                    <span class="service-badge" *ngIf="flight.services.loungeAccess">
                      <i class="fas fa-couch"></i>Accès salon
                    </span>
                  </div>
                </div>
                
                <div class="flight-actions">
                  <button class="favorite-btn" 
                          (click)="toggleFavorite(flight); $event.stopPropagation()"
                          [class.favorited]="flight.favorite">
                    <i class="far fa-heart" [class.fas]="flight.favorite"></i>
                  </button>
                  
                  <button class="compare-btn" 
                          (click)="addToComparison(flight); $event.stopPropagation()"
                          [class.in-comparison]="isInComparison(flight)"
                          [disabled]="comparisonFlights.length >= 3 && !isInComparison(flight)">
                    <i class="fas" [class.fa-plus]="!isInComparison(flight)" [class.fa-check]="isInComparison(flight)"></i>
                    {{isInComparison(flight) ? 'Dans la comparaison' : 'Comparer'}}
                  </button>
                </div>
              </div>
              
              <div class="flight-price-section">
                <div class="price">{{flight.price.toLocaleString()}} {{flight.currency}}</div>
                <button class="select-btn" 
                        [class.selected]="selectedFlight?.id === flight.id">
                  {{selectedFlight?.id === flight.id ? 'Sélectionné' : 'Sélectionner'}}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Vols retour -->
      <div class="flight-category" *ngIf="hasReturnFlights()">
        <h3 class="category-title">
          <i class="fas fa-plane-arrival me-2"></i>Vols retour
        </h3>
        <div class="flights-list">
          <div *ngFor="let flight of getReturnFlights()" 
               class="flight-card"
               [class.selected]="selectedReturnFlight?.id === flight.id"
               (click)="selectReturnFlight(flight)">
            
            <div class="flight-content">
              <div class="flight-main">
                <div class="flight-times">
                  <h4 class="flight-time">{{flight.departureTime}} - {{flight.arrivalTime}}</h4>
                  <p class="flight-route">{{flight.departure}} - {{flight.arrival}} • {{flight.duration}} • Direct</p>
                  <p class="flight-details">{{flight.airline}} • {{flight.aircraft}}</p>
                  
                  <!-- Services inclus -->
                  <div class="flight-services" *ngIf="flight.services">
                    <span class="service-badge" *ngIf="flight.services.meal">
                      <i class="fas fa-utensils"></i>Repas
                    </span>
                    <span class="service-badge" *ngIf="flight.services.wifi">
                      <i class="fas fa-wifi"></i>WiFi
                    </span>
                    <span class="service-badge" *ngIf="flight.services.entertainment">
                      <i class="fas fa-tv"></i>Divertissement
                    </span>
                    <span class="service-badge" *ngIf="flight.services.priorityBoarding">
                      <i class="fas fa-fast-forward"></i>Embarquement prioritaire
                    </span>
                    <span class="service-badge" *ngIf="flight.services.extraLegroom">
                      <i class="fas fa-chair"></i>Espace supplémentaire
                    </span>
                    <span class="service-badge" *ngIf="flight.services.loungeAccess">
                      <i class="fas fa-couch"></i>Accès salon
                    </span>
                  </div>
                </div>
                
                <div class="flight-actions">
                  <button class="favorite-btn" 
                          (click)="toggleFavorite(flight); $event.stopPropagation()"
                          [class.favorited]="flight.favorite">
                    <i class="far fa-heart" [class.fas]="flight.favorite"></i>
                  </button>
                  
                  <button class="compare-btn" 
                          (click)="addToComparison(flight); $event.stopPropagation()"
                          [class.in-comparison]="isInComparison(flight)"
                          [disabled]="comparisonFlights.length >= 3 && !isInComparison(flight)">
                    <i class="fas" [class.fa-plus]="!isInComparison(flight)" [class.fa-check]="isInComparison(flight)"></i>
                    {{isInComparison(flight) ? 'Dans la comparaison' : 'Comparer'}}
                  </button>
                </div>
              </div>
              
              <div class="flight-price-section">
                <div class="price">{{flight.price.toLocaleString()}} {{flight.currency}}</div>
                <button class="select-btn" 
                        [class.selected]="selectedReturnFlight?.id === flight.id">
                  {{selectedReturnFlight?.id === flight.id ? 'Sélectionné' : 'Sélectionner'}}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section de comparaison -->
    <div class="comparison-section" *ngIf="showComparison && comparisonFlights.length > 0">
      <div class="comparison-header">
        <h3><i class="fas fa-balance-scale me-2"></i>Comparaison des vols</h3>
        <button class="btn btn-close-comparison" (click)="toggleComparison()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="comparison-table">
        <div class="comparison-header-row">
          <div class="comparison-cell header-cell">Critères</div>
          <div class="comparison-cell" *ngFor="let flight of comparisonFlights">
            <div class="flight-header">
              <div class="flight-info">
                <h6>{{flight.airline}}</h6>
                <p>{{flight.flightNumber}}</p>
              </div>
              <button class="btn btn-remove-small" (click)="removeFromComparison(flight)">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="comparison-row">
          <div class="comparison-cell criteria-cell">Prix</div>
          <div class="comparison-cell" *ngFor="let flight of comparisonFlights">
            <div class="price-comparison">
              <span class="price">{{flight.price.toLocaleString()}} {{flight.currency}}</span>
            </div>
          </div>
        </div>

        <div class="comparison-row">
          <div class="comparison-cell criteria-cell">Durée</div>
          <div class="comparison-cell" *ngFor="let flight of comparisonFlights">
            <span class="duration">{{flight.duration}}</span>
          </div>
        </div>

        <div class="comparison-row">
          <div class="comparison-cell criteria-cell">Services</div>
          <div class="comparison-cell" *ngFor="let flight of comparisonFlights">
            <div class="services-comparison">
              <span class="service" *ngIf="flight.services?.meal">🍽️ Repas</span>
              <span class="service" *ngIf="flight.services?.wifi">📶 WiFi</span>
              <span class="service" *ngIf="flight.services?.entertainment">📺 Divertissement</span>
              <span class="service" *ngIf="flight.services?.priorityBoarding">⚡ Embarquement prioritaire</span>
              <span class="service" *ngIf="flight.services?.extraLegroom">🪑 Espace supplémentaire</span>
              <span class="service" *ngIf="flight.services?.loungeAccess">🛋️ Accès salon</span>
            </div>
          </div>
        </div>

        <div class="comparison-row actions-row">
          <div class="comparison-cell criteria-cell">Actions</div>
          <div class="comparison-cell" *ngFor="let flight of comparisonFlights">
            <button class="btn btn-select-comparison" 
                    (click)="flight.isReturnFlight ? selectReturnFlight(flight) : selectFlight(flight)">
              <i class="fas fa-check"></i>
              Sélectionner
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Aucun vol trouvé -->
    <div *ngIf="availableFlights.length === 0" class="no-results">
      <div class="no-results-icon">
        <i class="fas fa-search"></i>
      </div>
      <h4>Aucun vol trouvé</h4>
      <p>Vos critères de recherche ne correspondent à aucun vol disponible.</p>
    </div>
  </div>

  <!-- Navigation -->
  <div class="navigation-section">
    <button class="btn btn-back" (click)="prevStep()">
      <i class="fas fa-arrow-left me-2"></i>Retour
    </button>
    <button class="btn btn-continue" 
            (click)="nextStep()"
            [disabled]="!selectedFlight">
      Continuer <i class="fas fa-arrow-right ms-2"></i>
    </button>
  </div>
</div>
